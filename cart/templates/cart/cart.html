{% extends 'main/home.html' %}
{% block content %}
<h2>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h2>

{% if cart_items %}
<table id="cart-table">
    <tr>
        <th>–¢–æ–≤–∞—Ä</th>
        <th>–¶–µ–Ω–∞ –∑–∞ —à—Ç.</th>
        <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
        <th>–°—É–º–º–∞</th>
        <th></th>
    </tr>
    {% for item in cart_items %}
    <tr data-price="{{ item.toy.price }}">
        <td>
            <img src="{{ item.toy.image.url }}" alt="{{ item.toy.name }}" style="width:80px; border-radius:8px;">
            {{ item.toy.name }}
        </td>
        <td>{{ item.toy.price }} ‚Ç∏</td>
        <td>
            <input type="number" min="1" value="{{ item.quantity }}" class="quantity-input"
                   data-item-id="{{ item.id }}" style="width: 60px;">
        </td>
        <td class="item-total">{{ item.total_price }} ‚Ç∏</td>
        <td>
            <a href="{% url 'remove_from_cart' item.id %}" style="color: red;">–£–¥–∞–ª–∏—Ç—å</a>
        </td>
    </tr>
    {% endfor %}
</table>

<p style="margin-top: 20px; font-size: 18px;">
    <strong>–ò—Ç–æ–≥–æ: <span id="cart-total">{{ total }}</span> ‚Ç∏</strong>
</p>


{% if cart_items %}
    <div style="text-align:center; margin-top: 30px;">
        <form method="post" action="{% url 'checkout_cart' %}">
            {% csrf_token %}
            <button type="submit" style="
                background: #ff7a93;
                color: white;
                padding: 12px 30px;
                border: none;
                border-radius: 10px;
                cursor: pointer;
                font-size: 18px;">
                üí≥ –û–ø–ª–∞—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
            </button>
        </form>
    </div>
{% endif %}


{% else %}
<p>–í –∫–æ—Ä–∑–∏–Ω–µ –ø–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤.</p>
{% endif %}

<script>
document.addEventListener("DOMContentLoaded", () => {
    const inputs = document.querySelectorAll(".quantity-input");
    const cartTotalElem = document.getElementById("cart-total");

    inputs.forEach(input => {
        input.addEventListener("input", () => {
            const row = input.closest("tr");
            const price = parseFloat(row.dataset.price);
            const quantity = parseInt(input.value);
            const itemTotalCell = row.querySelector(".item-total");

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É–º–º—É –ø–æ —Ç–æ–≤–∞—Ä—É
            const itemTotal = price * quantity;
            itemTotalCell.textContent = itemTotal + " ‚Ç∏";

            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â—É—é —Å—É–º–º—É
            let total = 0;
            document.querySelectorAll(".item-total").forEach(cell => {
                total += parseFloat(cell.textContent);
            });
            cartTotalElem.textContent = total.toFixed(2);
        });
    });
});
</script>
{% endblock %}


