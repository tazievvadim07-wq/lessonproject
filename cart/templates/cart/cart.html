{% extends 'main/home.html' %}
{% block content %}
<h2>Ваша корзина</h2>

{% if cart_items %}
<table id="cart-table">
    <tr>
        <th>Товар</th>
        <th>Цена за шт.</th>
        <th>Количество</th>
        <th>Сумма</th>
        <th></th>
    </tr>
    {% for item in cart_items %}
    <tr data-price="{{ item.toy.price }}">
        <td>
            <img src="{{ item.toy.image.url }}" alt="{{ item.toy.name }}" style="width:80px; border-radius:8px;">
            {{ item.toy.name }}
        </td>
        <td>{{ item.toy.price }} ₸</td>
        <td>
            <input type="number" min="1" value="{{ item.quantity }}" class="quantity-input"
                   data-item-id="{{ item.id }}" style="width: 60px;">
        </td>
        <td class="item-total">{{ item.total_price }} ₸</td>
        <td>
            <a href="{% url 'remove_from_cart' item.id %}" style="color: red;">Удалить</a>
        </td>
    </tr>
    {% endfor %}
</table>

<p style="margin-top: 20px; font-size: 18px;">
    <strong>Итого: <span id="cart-total">{{ total }}</span> ₸</strong>
</p>

{% else %}
<p>В корзине пока нет товаров.</p>
{% endif %}

<script>
document.addEventListener("DOMContentLoaded", () => {
    const inputs = document.querySelectorAll(".quantity-input");
    const cartTotalElem = document.getElementById("cart-total");

    inputs.forEach(input => {
        input.addEventListener("input", () => {
            const row = input.closest("tr");
            const price = parseFloat(row.dataset.price);
            const quantity = parseInt(input.value);
            const itemTotalCell = row.querySelector(".item-total");

            // Обновляем сумму по товару
            const itemTotal = price * quantity;
            itemTotalCell.textContent = itemTotal + " ₸";

            // Пересчитываем общую сумму
            let total = 0;
            document.querySelectorAll(".item-total").forEach(cell => {
                total += parseFloat(cell.textContent);
            });
            cartTotalElem.textContent = total.toFixed(2);
        });
    });
});
</script>
{% endblock %}


